(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[382],{3305:(e,t,s)=>{Promise.resolve().then(s.bind(s,9756))},5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},8810:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(5155);function n(e){let{title:t,children:s}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden border border-slate-200",children:[(0,a.jsx)("div",{className:"p-4 border-b border-slate-200 bg-slate-50",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-slate-800",children:t})}),(0,a.jsx)("div",{className:"p-4",children:s})]})}},9756:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(5155),n=s(2115),l=s(5695),r=s(2214),i=s(4008),d=s(6972),c=s(8810);function u(e){let{children:t}=e;return(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:t})}var o=s(9081),x=s(1776);function h(e){if(!e)return"Invalid Time";let t=e.split(":");return 3===t.length?"".concat(t[0],":").concat(t[1]):"Invalid Time"}function m(){let e=(0,l.useRouter)(),[t,s]=(0,n.useState)([]),[i,d]=(0,n.useState)({total:0,pending:0,approved:0,rejected:0}),[o,h]=(0,n.useState)(null),[m,g]=(0,n.useState)(!1),[p,f]=(0,n.useState)(!0),[v,N]=(0,n.useState)(null);function w(e){let t=e.filter(e=>0===e.status||"Menunggu"===e.status).length,s=e.filter(e=>1===e.status||"Disetujui"===e.status).length,a=e.filter(e=>2===e.status||"Ditolak"===e.status).length;d({total:e.length,pending:t,approved:s,rejected:a})}async function y(e){if(confirm("Are you sure you want to delete this submission?"))try{let{error:t}=await r.N.from("submissions").delete().eq("id",e);if(t)throw t;s(t=>t.filter(t=>t.id!==e))}catch(e){alert("Gagal menghapus pengajuan. Coba lagi.")}}return(0,n.useEffect)(()=>{!async function(){f(!0);try{let{data:e,error:t}=await r.N.from("submissions").select("*").order("created_at",{ascending:!1}).limit(5);if(t)throw t;s(e),w(e)}catch(e){N(e.message)}finally{f(!1)}}();let e=r.N.channel("supabase_realtime").on("postgres_changes",{event:"*",schema:"public",table:"submissions"},e=>{console.log("Realtime update:",e),s(t=>{let s=[...t];return"INSERT"===e.eventType?s=[e.new,...t]:"UPDATE"===e.eventType?s=t.map(t=>t.id===e.new.id?e.new:t):"DELETE"===e.eventType&&(s=t.filter(t=>t.id!==e.old.id)),w(s),s})}).subscribe();return()=>e.unsubscribe()},[]),p?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):v?(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:v}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800",children:"Vendor Dashboard"}),(0,a.jsx)("button",{onClick:()=>e.push("/vendor/submit"),className:"px-4 py-2 bg-blue-800 text-white rounded-md hover:bg-blue-700 transition",children:"Tambah Pengajuan"})]}),(0,a.jsxs)(u,{children:[(0,a.jsx)(c.A,{title:"Total Pengajuan",children:(0,a.jsx)(b,{count:i.total,subtitle:"Pengajuan vendor",color:"text-blue-800"})}),(0,a.jsx)(c.A,{title:"Menunggu Verifikasi",children:(0,a.jsx)(b,{count:i.pending,subtitle:"Pengajuan dalam proses",color:"text-yellow-600"})}),(0,a.jsx)(c.A,{title:"Disetujui",children:(0,a.jsx)(b,{count:i.approved,subtitle:"Pengajuan disetujui",color:"text-green-600"})})]}),(0,a.jsx)(j,{submissions:t,onEdit:function(t){e.push("/vendor/submit?id=".concat(t))},onDelete:y,onView:function(e){h(e),g(!0)}}),m&&o&&(0,a.jsx)(x.A,{selectedSubmission:o,closeDetailModal:()=>{h(null),g(!1)}})]})}function b(e){let{count:t,subtitle:s,color:n}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold ".concat(n),children:t}),(0,a.jsx)("p",{className:"text-slate-600",children:s})]})}function j(e){let{submissions:t,onEdit:s,onDelete:n,onView:l}=e;return 0===t.length?(0,a.jsx)("div",{className:"bg-white rounded-lg p-6 text-center text-gray-500 border border-slate-200 shadow-md",children:"Belum ada pengajuan. Klik Tambah Pengajuan untuk membuat pengajuan baru."}):(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-slate-200 shadow-md overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 border-b border-slate-200 bg-slate-50",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-slate-800",children:"Pengajuan Terbaru"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-slate-200",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)(g,{children:"Vendor"}),(0,a.jsx)(g,{children:"Deskripsi Pekerjaan"}),(0,a.jsx)(g,{children:"Jadwal"}),(0,a.jsx)(g,{children:"Status"}),(0,a.jsx)(g,{children:"Aksi"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-slate-200",children:t.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,a.jsxs)(p,{children:[(0,a.jsx)("div",{className:"font-medium text-slate-900",children:e.vendor_name}),(0,a.jsxs)("div",{className:"text-sm text-slate-500",children:["SIMJA: ",e.simja_number]})]}),(0,a.jsxs)(p,{children:[(0,a.jsx)("div",{className:"text-slate-900 max-w-xs truncate",children:e.job_description}),(0,a.jsxs)("div",{className:"text-sm text-slate-500",children:["Pekerja: ",e.worker_count," orang"]})]}),(0,a.jsxs)(p,{children:[(0,a.jsxs)("div",{children:[(0,i.GP)(new Date(e.start_date),"d MMMM yyyy",{locale:d.id})," s/d ",(0,i.GP)(new Date(e.end_date),"d MMMM yyyy",{locale:d.id})]}),(0,a.jsxs)("div",{className:"text-sm text-slate-500",children:[h(e.start_time)," - ",h(e.end_time)]})]}),(0,a.jsx)(p,{children:(0,a.jsx)(o.A,{status:e.status})}),(0,a.jsx)(p,{children:(0,a.jsx)("div",{className:"flex space-x-2 text-sm font-medium",children:0==e.status?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>s(e.id),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded text-xs",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>n(e.id),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded text-xs",children:"Delete"})]}):(0,a.jsx)("button",{onClick:()=>l(e),className:"px-6 py-2 border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white rounded text-xs transition",children:"Detail"})})})]},e.id))})]})})]})}function g(e){let{children:t}=e;return(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:t})}function p(e){let{children:t}=e;return(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,293,789,441,684,358],()=>t(3305)),_N_E=e.O()}]);