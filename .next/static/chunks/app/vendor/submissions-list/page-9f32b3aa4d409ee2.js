(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[530],{1268:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var a=t(5155),l=t(2115),i=t(1032),n=t(6268),r=t(2214),d=t(9081),c=t(1776);t(8602);var o=t(4008),x=t(6972),m=t(5695);function u(){let[e,s]=(0,l.useState)([]),[t,u]=(0,l.useState)(""),[h,p]=(0,l.useState)(!0),[j,b]=(0,l.useState)(!1),[g,v]=(0,l.useState)(null),[N,f]=(0,l.useState)(!1),w=(0,m.useRouter)();(0,l.useEffect)(()=>{(async()=>{let{data:e,error:t}=await r.N.from("submissions").select("*").order("created_at",{ascending:!1});t||s(e),p(!1)})();let e=r.N.channel("supabase_realtime").on("postgres_changes",{event:"*",schema:"public",table:"submissions"},e=>{console.log("Realtime update:",e),s(s=>{let t=[...s];return"INSERT"===e.eventType?t=[e.new,...s]:"UPDATE"===e.eventType?t=s.map(s=>s.id===e.new.id?e.new:s):"DELETE"===e.eventType&&(t=s.filter(s=>s.id!==e.old.id)),t})}).subscribe();return()=>{e.unsubscribe()}},[]);let y=e=>{e&&(v(e),f(!0))},S=e=>{w.push("/vendor/submit?id=".concat(e))};async function _(e){if(confirm("Are you sure you want to delete this submission?")){b(!0);try{let{error:t}=await r.N.from("submissions").delete().eq("id",e);if(t)throw t;s(s=>s.filter(s=>s.id!==e))}catch(e){alert("Failed to delete the submission. Please try again.")}finally{b(!1)}}}let k=(0,l.useMemo)(()=>{let e=(0,i.FB)();return[e.accessor("vendor_name",{header:"Vendor",cell:e=>{let s=e.row.original;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:e.getValue()||"-"}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:["SIMJA: ",s.simja_number||"-"]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:["SIKA: ",s.sika_number||"-"]})]})}}),e.accessor("job_description",{header:"Deskripsi",cell:e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:e.getValue()}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[(0,a.jsx)("b",{children:"Pekerja:"})," ",e.row.original.worker_count,(0,a.jsx)("br",{}),(0,a.jsx)("b",{children:"Sarana Kerja:"})," ",e.row.original.equipment]})]}),enableSorting:!0,meta:{width:"250px"}}),e.accessor("start_date",{header:"Jadwal",cell:e=>{let s=e.row.original,t=(0,o.GP)(new Date(s.start_date),"d MMMM yyyy",{locale:x.id}),l=(0,o.GP)(new Date(s.end_date),"d MMMM yyyy",{locale:x.id});return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:[t," s/d ",l]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[s.start_time," - ",s.end_time]})]})},enableSorting:!0,meta:{width:"150px"}}),e.accessor("status",{header:"Status",cell:e=>(0,a.jsx)(d.A,{status:e.getValue()}),enableSorting:!0,meta:{width:"120px"}}),e.accessor("created_at",{header:"Created At",cell:e=>new Date(e.getValue()).toLocaleDateString(),enableSorting:!0,meta:{width:"180px"}}),e.accessor("id",{header:"Aksi",cell:e=>{let s=e.row.original;return(0,a.jsx)("div",{className:"flex space-x-2 text-sm font-medium",children:0==s.status?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>S(s.id),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded text-xs",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>_(s.id),className:"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded text-xs",disabled:j,children:j?(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):"Delete"})]}):(0,a.jsx)("button",{onClick:()=>y(s),className:"px-6 py-2 border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white rounded text-xs transition",children:"Detail"})})},enableSorting:!1,meta:{width:"200px"}})]},[j]),P=(0,n.N4)({data:e,columns:k,state:{globalFilter:t},onGlobalFilterChange:u,getCoreRowModel:(0,i.HT)(),getFilteredRowModel:(0,i.hM)(),getSortedRowModel:(0,i.h5)(),getPaginationRowModel:(0,i.kW)()});return h?(0,a.jsx)("div",{className:"text-center py-10",children:"Loading..."}):(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-semibold text-slate-800",children:"Riwayat Pengajuan"}),(0,a.jsxs)("div",{className:"overflow-x-auto bg-white p-4 rounded-xl shadow-md mt-4",children:[(0,a.jsxs)("table",{className:"min-w-full text-sm text-left text-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:P.getHeaderGroups().map(e=>(0,a.jsx)("tr",{children:e.headers.map(e=>{var s;return(0,a.jsx)("th",{className:"px-4 py-2 font-medium text-xs uppercase cursor-pointer",onClick:e.column.getToggleSortingHandler(),style:{width:null==(s=e.column.columnDef.meta)?void 0:s.width},children:!e.isPlaceholder&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.Kv)(e.column.columnDef.header,e.getContext()),"desc"===e.column.getIsSorted()&&(0,a.jsx)("span",{children:"↓"}),"asc"===e.column.getIsSorted()&&(0,a.jsx)("span",{children:"↑"})]})},e.id)})},e.id))}),(0,a.jsx)("tbody",{children:P.getRowModel().rows.map(e=>(0,a.jsx)("tr",{className:"border-b hover:bg-gray-50",children:e.getVisibleCells().map(e=>{var s;return(0,a.jsx)("td",{className:"px-4 py-2 align-top",style:{width:null==(s=e.column.columnDef.meta)?void 0:s.width},children:(0,n.Kv)(e.column.columnDef.cell,e.getContext())},e.id)})},e.id))})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-slate-600",children:["Page ",P.getState().pagination.pageIndex+1," of"," ",P.getPageCount()]}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 bg-slate-200 rounded disabled:opacity-50",onClick:()=>P.previousPage(),disabled:!P.getCanPreviousPage(),children:"Prev"}),(0,a.jsx)("button",{className:"px-3 py-1 bg-slate-200 rounded disabled:opacity-50",onClick:()=>P.nextPage(),disabled:!P.getCanNextPage(),children:"Next"})]})]})]}),N&&(0,a.jsx)(c.A,{data:g,onClose:()=>{v(null),f(!1)}})]})}},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},8379:(e,s,t)=>{Promise.resolve().then(t.bind(t,1268))},8602:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var a=t(5155),l=t(2115),i=t(2214);function n(e){let{selectedSubmission:s,closeDetailModal:t}=e,[n,r]=(0,l.useState)(s.status),[d,c]=(0,l.useState)(!1),o=async()=>{c(!0);let{error:e}=await i.N.from("submissions").update({status:n}).eq("id",s.id);c(!1),e?(alert("Gagal mengupdate status."),console.error(e)):(alert("Status berhasil diperbarui!"),t())};return(0,a.jsx)("div",{className:"fixed overflow-hidden",style:{position:"fixed",top:-25,left:0,right:0,bottom:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto m-4",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-slate-200 flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-slate-800",children:"Detail Pengajuan Vendor"}),(0,a.jsx)("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-800 mb-3",children:"Informasi Vendor"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Nama Vendor:"}),(0,a.jsx)("p",{children:s.vendor_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Nomor SIMJA:"}),(0,a.jsx)("p",{children:s.simja_number})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Nomor SIKA:"}),(0,a.jsx)("p",{children:s.sika_number})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Status:"}),(0,a.jsxs)("select",{value:n,onChange:e=>r(e.target.value),className:"mt-1 w-full border border-slate-300 rounded px-3 py-2 text-sm",children:[(0,a.jsx)("option",{value:"0",children:"Pending"}),(0,a.jsx)("option",{value:"1",children:"Approved"}),(0,a.jsx)("option",{value:"2",children:"Rejected"}),(0,a.jsx)("option",{value:"3",children:"Expired"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-800 mb-3",children:"Detail Pekerjaan"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Deskripsi:"}),(0,a.jsx)("p",{children:s.job_description})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Sarana Kerja:"}),(0,a.jsx)("p",{children:s.equipment})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Jumlah Pekerja:"}),(0,a.jsxs)("p",{children:[s.worker_count," orang"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-800 mb-3",children:"Jadwal Pekerjaan"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Tanggal Mulai:"}),(0,a.jsx)("p",{children:s.start_date})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Tanggal Selesai:"}),(0,a.jsx)("p",{children:s.end_date})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Jam Kerja:"}),(0,a.jsxs)("p",{children:[s.start_time," - ",s.end_time]})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-800 mb-3",children:"Informasi Lain"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Dibuat:"}),(0,a.jsx)("p",{children:new Date(s.created_at).toLocaleString("id-ID")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Diperbarui:"}),(0,a.jsx)("p",{children:new Date(s.updated_at).toLocaleString("id-ID")})]})]})]})]}),(0,a.jsxs)("div",{className:"p-6 border-t flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:t,className:"px-4 py-2 border border-slate-300 text-slate-700 rounded hover:bg-slate-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:o,disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:d?"Menyimpan...":"Simpan Perubahan"})]})]})})}t(9081)}},e=>{var s=s=>e(e.s=s);e.O(0,[851,293,268,789,441,684,358],()=>s(8379)),_N_E=e.O()}]);