(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[806],{2321:(e,s,t)=>{Promise.resolve().then(t.bind(t,3688))},3688:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var a=t(5155),l=t(2115),d=t(2214),i=t(8810);t(1776);var n=t(9081),r=t(8602);function c(){let[e,s]=(0,l.useState)([]),[t,c]=(0,l.useState)({total:0,pending:0,approved:0,rejected:0}),[x,o]=(0,l.useState)(null),[m,h]=(0,l.useState)(!1),[u,p]=(0,l.useState)(!1),[j,b]=(0,l.useState)(""),[N,v]=(0,l.useState)(!0),[f,g]=(0,l.useState)(null),w=(0,l.useCallback)(e=>({total:e.length,pending:e.filter(e=>1===e.status).length,approved:e.filter(e=>2===e.status).length,rejected:e.filter(e=>3===e.status).length}),[]),y=(0,l.useCallback)(async()=>{try{let{data:e,error:t}=await d.N.from("submissions").select("*").order("created_at",{ascending:!1}).limit(5);if(t)throw t;s(e),c(w(e))}catch(e){g(e.message)}finally{v(!1)}},[w]);(0,l.useEffect)(()=>{y();let e=d.N.channel("supabase_realtime").on("postgres_changes",{event:"*",schema:"public",table:"submissions"},e=>{console.log("Realtime update:",e),s(s=>{let t=[...s];return"INSERT"===e.eventType?t=[e.new,...s]:"UPDATE"===e.eventType?t=s.map(s=>s.id===e.new.id?e.new:s):"DELETE"===e.eventType&&(t=s.filter(s=>s.id!==e.old.id)),c(w(t)),t})}).subscribe();return()=>{e.unsubscribe()}},[y,w]);let k=e=>{o(e),h(!0)};return N?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):f?(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:f}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-semibold text-slate-800",children:"HSE Officer Dashboard"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsx)(i.A,{title:"Total Pengajuan",children:(0,a.jsx)("p",{className:"text-3xl font-bold",children:t.total})}),(0,a.jsx)(i.A,{title:"Menunggu Verifikasi",children:(0,a.jsx)("p",{className:"text-3xl font-bold text-amber-600",children:t.pending})}),(0,a.jsx)(i.A,{title:"Disetujui",children:(0,a.jsx)("p",{className:"text-3xl font-bold text-emerald-600",children:t.approved})}),(0,a.jsx)(i.A,{title:"Ditolak",children:(0,a.jsx)("p",{className:"text-3xl font-bold text-red-600",children:t.rejected})})]}),(0,a.jsxs)("div",{className:"overflow-y-auto bg-white p-4 rounded-xl shadow-md max-w-full",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-slate-800",children:"Daftar Pengajuan"}),(0,a.jsxs)("table",{className:"min-w-full table-fixed text-sm text-slate-700",children:[(0,a.jsx)("thead",{className:"bg-slate-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Vendor"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Deskripsi Pekerjaan"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Jadwal"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Aksi"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-slate-50 border-b border-slate-200",children:[(0,a.jsxs)("td",{className:"px-3 py-2 align-top",children:[(0,a.jsx)("div",{className:"font-semibold",children:e.vendor_name}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:["SIMJA: ",e.simja_number]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:["SIKA: ",e.sika_number]})]}),(0,a.jsxs)("td",{className:"px-3 py-2 align-top",children:[(0,a.jsx)("div",{className:"truncate max-w-xs",children:e.job_description}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[(0,a.jsx)("b",{children:"Pekerja:"})," ",e.worker_count]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[(0,a.jsx)("b",{children:"Sarana Kerja:"})," ",e.equipment]})]}),(0,a.jsxs)("td",{className:"px-3 py-2 align-top whitespace-nowrap",children:[(0,a.jsxs)("div",{children:[e.start_date," s/d ",e.end_date]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[e.start_time," - ",e.end_time]})]}),(0,a.jsx)("td",{className:"px-3 py-2 align-top",children:(0,a.jsx)(n.A,{status:e.status})}),(0,a.jsx)("td",{className:"px-3 py-2 align-top",children:(0,a.jsx)("button",{onClick:()=>k(e),className:"px-6 py-2 border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white rounded text-xs transition",children:"Detail"})})]},e.id))})]})]}),m&&x&&(0,a.jsx)(r.A,{selectedSubmission:x,closeDetailModal:()=>h(!1)})]})}},8602:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var a=t(5155),l=t(2115),d=t(2214);function i(e){let{selectedSubmission:s,closeDetailModal:t}=e,[i,n]=(0,l.useState)(s.status),[r,c]=(0,l.useState)(!1),x=async()=>{c(!0);let{error:e}=await d.N.from("submissions").update({status:i}).eq("id",s.id);c(!1),e?(alert("Gagal mengupdate status."),console.error(e)):(alert("Status berhasil diperbarui!"),t())};return(0,a.jsx)("div",{className:"fixed overflow-hidden",style:{position:"fixed",top:-25,left:0,right:0,bottom:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto m-4",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-slate-200 flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-slate-800",children:"Detail Pengajuan Vendor"}),(0,a.jsx)("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-800 mb-3",children:"Informasi Vendor"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Nama Vendor:"}),(0,a.jsx)("p",{children:s.vendor_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Nomor SIMJA:"}),(0,a.jsx)("p",{children:s.simja_number})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Nomor SIKA:"}),(0,a.jsx)("p",{children:s.sika_number})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Status:"}),(0,a.jsxs)("select",{value:i,onChange:e=>n(e.target.value),className:"mt-1 w-full border border-slate-300 rounded px-3 py-2 text-sm",children:[(0,a.jsx)("option",{value:"0",children:"Pending"}),(0,a.jsx)("option",{value:"1",children:"Approved"}),(0,a.jsx)("option",{value:"2",children:"Rejected"}),(0,a.jsx)("option",{value:"3",children:"Expired"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-800 mb-3",children:"Detail Pekerjaan"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Deskripsi:"}),(0,a.jsx)("p",{children:s.job_description})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Sarana Kerja:"}),(0,a.jsx)("p",{children:s.equipment})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Jumlah Pekerja:"}),(0,a.jsxs)("p",{children:[s.worker_count," orang"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-800 mb-3",children:"Jadwal Pekerjaan"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Tanggal Mulai:"}),(0,a.jsx)("p",{children:s.start_date})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Tanggal Selesai:"}),(0,a.jsx)("p",{children:s.end_date})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Jam Kerja:"}),(0,a.jsxs)("p",{children:[s.start_time," - ",s.end_time]})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold text-slate-800 mb-3",children:"Informasi Lain"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Dibuat:"}),(0,a.jsx)("p",{children:new Date(s.created_at).toLocaleString("id-ID")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:"Diperbarui:"}),(0,a.jsx)("p",{children:new Date(s.updated_at).toLocaleString("id-ID")})]})]})]})]}),(0,a.jsxs)("div",{className:"p-6 border-t flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:t,className:"px-4 py-2 border border-slate-300 text-slate-700 rounded hover:bg-slate-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:x,disabled:r,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:r?"Menyimpan...":"Simpan Perubahan"})]})]})})}t(9081)},8810:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});var a=t(5155);function l(e){let{title:s,children:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden border border-slate-200",children:[(0,a.jsx)("div",{className:"p-4 border-b border-slate-200 bg-slate-50",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-slate-800",children:s})}),(0,a.jsx)("div",{className:"p-4",children:t})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[851,789,441,684,358],()=>s(2321)),_N_E=e.O()}]);